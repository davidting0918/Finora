<!-- test.html -->
<!DOCTYPE html>
<html>
<head>
    <title>WebSocket æ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #messages {
            border: 1px solid #ccc;
            height: 300px;
            padding: 10px;
            overflow-y: scroll;
            margin: 10px 0;
        }
        input[type="text"] { width: 300px; padding: 5px; }
        button { padding: 5px 10px; }
    </style>
</head>
<body>
    <h1>WebSocket æ¸¬è©¦é é¢</h1>

    <!-- æ­¥é©Ÿ 5aï¼šé¡¯ç¤ºè¨Šæ¯çš„å€åŸŸ -->
    <div id="messages"></div>

    <!-- æ­¥é©Ÿ 5bï¼šè¼¸å…¥å’Œç™¼é€è¨Šæ¯ -->
    <input type="text" id="messageInput" placeholder="è¼¸å…¥ä½ çš„è¨Šæ¯...">
    <button onclick="sendMessage()">ç™¼é€è¨Šæ¯</button>
    <button onclick="connectWebSocket()">é€£æ¥</button>
    <button onclick="disconnectWebSocket()">æ–·é–‹</button>

    <script>
        let socket = null;  // å­˜æ”¾ WebSocket é€£æ¥

        // æ­¥é©Ÿ 5cï¼šé€£æ¥ WebSocket çš„å‡½æ•¸
        function connectWebSocket() {
            // å»ºç«‹ WebSocket é€£æ¥
            socket = new WebSocket('ws://localhost:8000/ws');

            // æ­¥é©Ÿ 5dï¼šé€£æ¥æˆåŠŸæ™‚åŸ·è¡Œ
            socket.onopen = function(event) {
                addMessage('âœ… é€£æ¥æˆåŠŸï¼');
                console.log('WebSocket é€£æ¥å»ºç«‹');
            };

            // æ­¥é©Ÿ 5eï¼šæ”¶åˆ°è¨Šæ¯æ™‚åŸ·è¡Œ
            socket.onmessage = function(event) {
                addMessage('ğŸ“¨ æ”¶åˆ°ï¼š' + event.data);
                console.log('æ”¶åˆ°è¨Šæ¯ï¼š', event.data);
            };

            // æ­¥é©Ÿ 5fï¼šé€£æ¥é—œé–‰æ™‚åŸ·è¡Œ
            socket.onclose = function(event) {
                addMessage('âŒ é€£æ¥å·²é—œé–‰');
                console.log('WebSocket é€£æ¥é—œé–‰');
            };

            // æ­¥é©Ÿ 5gï¼šç™¼ç”ŸéŒ¯èª¤æ™‚åŸ·è¡Œ
            socket.onerror = function(error) {
                addMessage('ğŸ’¥ ç™¼ç”ŸéŒ¯èª¤ï¼š' + error);
                console.log('WebSocket éŒ¯èª¤ï¼š', error);
            };
        }

        // æ­¥é©Ÿ 5hï¼šç™¼é€è¨Šæ¯çš„å‡½æ•¸
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();

            if (message && socket && socket.readyState === WebSocket.OPEN) {
                // ç™¼é€è¨Šæ¯åˆ°ä¼ºæœå™¨
                socket.send(message);
                addMessage('ğŸ“¤ ç™¼é€ï¼š' + message);
                input.value = '';  // æ¸…ç©ºè¼¸å…¥æ¡†
            } else {
                addMessage('âš ï¸ è«‹å…ˆé€£æ¥ WebSocket æˆ–è¼¸å…¥è¨Šæ¯');
            }
        }

        // æ­¥é©Ÿ 5iï¼šæ–·é–‹é€£æ¥çš„å‡½æ•¸
        function disconnectWebSocket() {
            if (socket) {
                socket.close();
            }
        }

        // æ­¥é©Ÿ 5jï¼šåœ¨é é¢ä¸Šé¡¯ç¤ºè¨Šæ¯çš„å‡½æ•¸
        function addMessage(message) {
            const messages = document.getElementById('messages');
            const messageElement = document.createElement('div');
            messageElement.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            messages.appendChild(messageElement);
            messages.scrollTop = messages.scrollHeight;  // è‡ªå‹•æ²åˆ°æœ€åº•éƒ¨
        }

        // æ­¥é©Ÿ 5kï¼šæŒ‰ Enter éµä¹Ÿèƒ½ç™¼é€è¨Šæ¯
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>
